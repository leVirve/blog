<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>Dcard çˆ¬èŸ²æ–¼ Python å¯¦ä½œæˆæœï¼šdcard-spider | Salas&#39;</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="ä¸Šæ¬¡è«‡åˆ°äº† Dcard ç¾åœ¨å®˜æ–¹å¯¦éš› production ä¸­ä½¿ç”¨çš„ API URL è¦å‰‡ï¼Œä¸¦ä¸”æ’°å¯«äº†ç°¡å–®çš„ Python scripts ä¾†å–çš„å°éƒ¨åˆ†è³‡æ–™ã€‚è€Œé€™æ¨£çš„æˆæœé©åˆç”¨ä¾†åšå°è¦æ¨¡çš„å¾ŒçºŒæ‡‰ç”¨ï¼Œä¾‹å¦‚ç‰¹å®šç‰ˆçš„ç•¶æ—¥æˆ–ç•¶æœˆæ–‡ç« åˆ†æç­‰ç­‰ï¼›ç„¶è€Œè‹¥æ˜¯è¦æ‹¿ä¸‹å…¨ç«™çš„è³‡æ–™ï¼Œé‚£éº¼æˆ‘å€‘ä¸Šæ¬¡çš„ç¨‹å¼ç¯„ä¾‹æœ¬èº«å¿…é ˆè¦æ”¹å–„ä¾†è®“å¾ŒçºŒæ–¹ä¾¿æ“´å……ï¼ˆå…¶å¯¦æ˜¯ä¸Šæ¬¡ç¨‹å¼è¶•å·¥å¯«å¤ªé†œï¼Œç”Ÿç†ä¸Šä¸èƒ½æ¥å—(?) å®Œå…¨æ²’æœ‰æƒ³è¦ç›´æ¥æ²¿ç”¨çš„å¿µé ­ XDï¼‰ã€‚">
<meta property="og:type" content="article">
<meta property="og:title" content="Dcard çˆ¬èŸ²æ–¼ Python å¯¦ä½œæˆæœï¼šdcard-spider">
<meta property="og:url" content="http://yoursite.com/2016/dcard-spider-python-package/index.html">
<meta property="og:site_name" content="Salas'">
<meta property="og:description" content="ä¸Šæ¬¡è«‡åˆ°äº† Dcard ç¾åœ¨å®˜æ–¹å¯¦éš› production ä¸­ä½¿ç”¨çš„ API URL è¦å‰‡ï¼Œä¸¦ä¸”æ’°å¯«äº†ç°¡å–®çš„ Python scripts ä¾†å–çš„å°éƒ¨åˆ†è³‡æ–™ã€‚è€Œé€™æ¨£çš„æˆæœé©åˆç”¨ä¾†åšå°è¦æ¨¡çš„å¾ŒçºŒæ‡‰ç”¨ï¼Œä¾‹å¦‚ç‰¹å®šç‰ˆçš„ç•¶æ—¥æˆ–ç•¶æœˆæ–‡ç« åˆ†æç­‰ç­‰ï¼›ç„¶è€Œè‹¥æ˜¯è¦æ‹¿ä¸‹å…¨ç«™çš„è³‡æ–™ï¼Œé‚£éº¼æˆ‘å€‘ä¸Šæ¬¡çš„ç¨‹å¼ç¯„ä¾‹æœ¬èº«å¿…é ˆè¦æ”¹å–„ä¾†è®“å¾ŒçºŒæ–¹ä¾¿æ“´å……ï¼ˆå…¶å¯¦æ˜¯ä¸Šæ¬¡ç¨‹å¼è¶•å·¥å¯«å¤ªé†œï¼Œç”Ÿç†ä¸Šä¸èƒ½æ¥å—(?) å®Œå…¨æ²’æœ‰æƒ³è¦ç›´æ¥æ²¿ç”¨çš„å¿µé ­ XDï¼‰ã€‚">
<meta property="og:image" content="http://yoursite.com/2016/dcard-spider-python-package/Giant_spider_strikes.jpg">
<meta property="og:updated_time" content="2016-07-30T13:28:04.744Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="Dcard çˆ¬èŸ²æ–¼ Python å¯¦ä½œæˆæœï¼šdcard-spider">
<meta name="twitter:description" content="ä¸Šæ¬¡è«‡åˆ°äº† Dcard ç¾åœ¨å®˜æ–¹å¯¦éš› production ä¸­ä½¿ç”¨çš„ API URL è¦å‰‡ï¼Œä¸¦ä¸”æ’°å¯«äº†ç°¡å–®çš„ Python scripts ä¾†å–çš„å°éƒ¨åˆ†è³‡æ–™ã€‚è€Œé€™æ¨£çš„æˆæœé©åˆç”¨ä¾†åšå°è¦æ¨¡çš„å¾ŒçºŒæ‡‰ç”¨ï¼Œä¾‹å¦‚ç‰¹å®šç‰ˆçš„ç•¶æ—¥æˆ–ç•¶æœˆæ–‡ç« åˆ†æç­‰ç­‰ï¼›ç„¶è€Œè‹¥æ˜¯è¦æ‹¿ä¸‹å…¨ç«™çš„è³‡æ–™ï¼Œé‚£éº¼æˆ‘å€‘ä¸Šæ¬¡çš„ç¨‹å¼ç¯„ä¾‹æœ¬èº«å¿…é ˆè¦æ”¹å–„ä¾†è®“å¾ŒçºŒæ–¹ä¾¿æ“´å……ï¼ˆå…¶å¯¦æ˜¯ä¸Šæ¬¡ç¨‹å¼è¶•å·¥å¯«å¤ªé†œï¼Œç”Ÿç†ä¸Šä¸èƒ½æ¥å—(?) å®Œå…¨æ²’æœ‰æƒ³è¦ç›´æ¥æ²¿ç”¨çš„å¿µé ­ XDï¼‰ã€‚">
  
    <link rel="alternative" href="/atom.xml" title="Salas&#39;" type="application/atom+xml">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="//fonts.googleapis.com/css?family=Source+Code+Pro" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>
<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">Salas&#39;</a>
      </h1>
      
        <h2 id="subtitle-wrap">
          <a href="/" id="subtitle">Do it for your pride.</a>
        </h2>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
      </div>
    </div>
  </div>
</header>
      <div class="outer">
        <section id="main"><article id="post-dcard-spider-python-package" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-meta">
    <a href="/2016/dcard-spider-python-package/" class="article-date">
  <time datetime="2016-07-30T09:24:44.000Z" itemprop="datePublished">2016-07-30</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      Dcard çˆ¬èŸ²æ–¼ Python å¯¦ä½œæˆæœï¼šdcard-spider
    </h1>
  

      </header>
    
    <div class="article-entry" itemprop="articleBody">
      
        <p>ä¸Šæ¬¡è«‡åˆ°äº† Dcard ç¾åœ¨å®˜æ–¹å¯¦éš› production ä¸­ä½¿ç”¨çš„ API URL è¦å‰‡ï¼Œä¸¦ä¸”æ’°å¯«äº†ç°¡å–®çš„ Python scripts ä¾†å–çš„å°éƒ¨åˆ†è³‡æ–™ã€‚<br>è€Œé€™æ¨£çš„æˆæœé©åˆç”¨ä¾†åšå°è¦æ¨¡çš„å¾ŒçºŒæ‡‰ç”¨ï¼Œä¾‹å¦‚ç‰¹å®šç‰ˆçš„ç•¶æ—¥æˆ–ç•¶æœˆæ–‡ç« åˆ†æç­‰ç­‰ï¼›ç„¶è€Œè‹¥æ˜¯è¦æ‹¿ä¸‹å…¨ç«™çš„è³‡æ–™ï¼Œé‚£éº¼æˆ‘å€‘ä¸Šæ¬¡çš„ç¨‹å¼ç¯„ä¾‹æœ¬èº«å¿…é ˆè¦æ”¹å–„ä¾†è®“å¾ŒçºŒæ–¹ä¾¿æ“´å……ï¼ˆå…¶å¯¦æ˜¯ä¸Šæ¬¡ç¨‹å¼è¶•å·¥å¯«å¤ªé†œï¼Œç”Ÿç†ä¸Šä¸èƒ½æ¥å—(?) å®Œå…¨æ²’æœ‰æƒ³è¦ç›´æ¥æ²¿ç”¨çš„å¿µé ­ XDï¼‰ã€‚</p>
<p>é‚£éº¼æ¥ä¸‹ä¾†çš„æ¦‚å¿µå°±æ˜¯ï¼š</p>
<ol>
<li><p>æˆ‘è¦ä¸€éš»å¤§èœ˜è››ï¼ˆæ¯”èµ· crawlerï¼Œæˆ‘é¸æ“‡ Spiderï¼è½èµ·ä¾†å°±æ¯”è¼ƒçŒ›ï¼Œä»¥ä¸‹éƒ½ç”¨ spider ç¨±å‘¼é€™éš»ç¶²è·¯çˆ¬èŸ² é¡†é¡†ï¼‰</p>
<img src="/2016/dcard-spider-python-package/Giant_spider_strikes.jpg" alt="[Giant spider strikes from wiki]" title="[Giant spider strikes from wiki]">
</li>
<li><p>é‚£é™¤äº†æ ¸å¿ƒçš„è»€å¹¹ä¹‹å¤–éœ€è¦å…ˆé€ å…«éš» <del>èŸ¹</del> è…³å•Šï¼ä¸Šæ¬¡é‚£å€‹å“è³ªï¼ï¼ï¼å¯æ˜¯æ’ä¸èµ·é€™éš»å·¨å‹èœ˜è››çš„</p>
</li>
<li><p>ä¸çŸ¥æ‰€äº‘ï¼Œç¸½ä¹‹å°±æ˜¯æŠŠä¹‹å‰çš„æ¦‚å¿µæ‰“é€ æˆå¥½ç”¨çš„è…¿å°±å°äº†ã€‚ä¹‹å¾Œèœ˜è››å¥½è¾¦äº‹ï¼</p>
</li>
</ol>
<p>æˆæœå·²ç¶“ç™¼å¸ƒåœ¨ <a href="https://pypi.python.org/pypi/dcard-spider" target="_blank" rel="external">PyPI</a> ä»¥åŠ <a href="https://github.com/leVirve/dcard-spider" target="_blank" rel="external">Github</a> ä¸Šäº†ã€‚</p>
<a id="more"></a>
<h2 id="u61F6_u4EBA_u5305_uFF0C_u6211_u5C31_u5148_u5B89_u88DD_u518D_u8AAA"><a href="#u61F6_u4EBA_u5305_uFF0C_u6211_u5C31_u5148_u5B89_u88DD_u518D_u8AAA" class="headerlink" title="æ‡¶äººåŒ…ï¼Œæˆ‘å°±å…ˆå®‰è£å†èªª"></a>æ‡¶äººåŒ…ï¼Œæˆ‘å°±å…ˆå®‰è£å†èªª</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">pip install dcard-spider</span><br></pre></td></tr></table></figure>
<p>ä½†æ˜¯ <a href="https://pypi.python.org/pypi/dcard-spider" target="_blank" rel="external">dcard-spdier@PyPi</a> ä¸ä¿è­‰æœ‰ä»¥ä¸‹èªªçš„æœ€æ–°åŠŸèƒ½å”·ï¼Œå› ç‚ºæ²’æœ‰éš¨æ™‚ç™¼å¸ƒæœ€æ–°çš„ä¸Šå» XDD</p>
<h2 id="u61F6_u4EBA_u5305_uFF0C_u6211_u5C31_u52E4_u52DE_u4E00_u9EDE_u5230_Github__u88DD_u65B0_u7248"><a href="#u61F6_u4EBA_u5305_uFF0C_u6211_u5C31_u52E4_u52DE_u4E00_u9EDE_u5230_Github__u88DD_u65B0_u7248" class="headerlink" title="æ‡¶äººåŒ…ï¼Œæˆ‘å°±å‹¤å‹ä¸€é»åˆ° Github è£æ–°ç‰ˆ"></a>æ‡¶äººåŒ…ï¼Œæˆ‘å°±å‹¤å‹ä¸€é»åˆ° Github è£æ–°ç‰ˆ</h2><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">git <span class="built_in">clone</span> https://github.com/leVirve/dcard-spider</span><br><span class="line">python setup.py install</span><br></pre></td></tr></table></figure>
<p>è£å¥½ä¹‹å¾Œï¼Œå¯ä»¥å…ˆç…§è‘— README è£¡çš„ <code>command line</code> è©¦è©¦ä¸‹è¼‰åœ–ç‰‡åŠŸèƒ½ï¼Œæˆ–æ˜¯ç”¨ <code>program</code> è·‘ sample çœ‹çœ‹æ•ˆæœå¦‚ä½•ã€‚é‚£éº¼ä»¥ä¸‹åˆ†äº«æˆ‘çš„ Python packageï¼ˆå¥—ä»¶ï¼‰ç¨‹å¼æ¶æ§‹ï¼š</p>
<h2 id="u7A0B_u5F0F_u78BC"><a href="#u7A0B_u5F0F_u78BC" class="headerlink" title="ç¨‹å¼ç¢¼"></a>ç¨‹å¼ç¢¼</h2><p>å…ˆå®šç¾©ä¸€å€‹ <code>Dcard</code> é¡åˆ¥ä¾†æè¿°æ•´å€‹å¥—ä»¶æ‡‰è©²æœ‰çš„å­åŠŸèƒ½ï¼Œä¾‹å¦‚ç›®å‰æ”¯æ´ <code>forums</code> è·Ÿ <code>posts</code> å…©å€‹ APIï¼Œæ‰€ä»¥æˆ‘å®šç¾©äº†å…©å€‹å­é¡åˆ¥è² è²¬å„è‡ªåŠŸèƒ½ã€‚</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""" dcard.py """</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> dcard.forums <span class="keyword">import</span> Forum</span><br><span class="line"><span class="keyword">from</span> dcard.posts <span class="keyword">import</span> Post</span><br><span class="line"></span><br><span class="line">__all__ = [<span class="string">'Dcard'</span>]</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Dcard</span>:</span></span><br><span class="line">    forums = Forum</span><br><span class="line">    posts = Post</span><br></pre></td></tr></table></figure>
<ul>
<li><p>åœ¨ <code>Forum</code> ä¸­ä¸»è¦æœ‰å…©å€‹å°å¤–ï¼ˆä½œç‚ºå¥—ä»¶æä¾›çµ¦å¤–éƒ¨å‘¼å«ï¼‰çš„æ–¹æ³•</p>
<ol>
<li><p><code>get()</code> ä½œç‚ºéœæ…‹æ–¹æ³• (static method)</p>
<ul>
<li><p>ç”¨ä¾†å–å¾— <code>Dcard</code> ä¸Šå„å€‹çœ‹æ¿çš„å¾Œè¨­è³‡è¨Š (metadata)ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dcard.forums <span class="keyword">import</span> Forum</span><br><span class="line">metadata_forums = Forum.get()</span><br></pre></td></tr></table></figure>
</li>
<li><p>API å–å¾—çš„çµæœæ˜¯ <code>json</code> çš„ listï¼ŒåŸå§‹è³‡æ–™å¤§æ¦‚é•·é€™æ¨£ï¼šï¼ˆä½†åœ¨ç¨‹å¼è£¡å°±è®Šæˆ list of <code>dict</code>ï¼‰</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  ...,</span><br><span class="line">  &#123;</span><br><span class="line">    "<span class="attribute">id</span>": <span class="value"><span class="string">"c82dae3f-28ba-4aae-961d-c754e6ccd37a"</span></span>,</span><br><span class="line">    "<span class="attribute">name</span>": <span class="value"><span class="string">"æ‰‹ä½œ"</span></span>,</span><br><span class="line">    "<span class="attribute">description</span>": <span class="value"><span class="string">"ä¾›è¨è«–ã€åˆ†äº«ã€è©¢å•å„ç¨®æ‰‹ä½œã€éæ–‡å­—å‰µä½œå“ï¼Œéç›¸é—œè©±é¡Œæœƒåˆªé™¤è©²æ–‡"</span></span>,</span><br><span class="line">    "<span class="attribute">alias</span>": <span class="value"><span class="string">"handicrafts"</span></span>,</span><br><span class="line">    "<span class="attribute">fullyAnonymous</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">subscriptionCount</span>": <span class="value"><span class="number">2893</span></span>,</span><br><span class="line">    "<span class="attribute">invisible</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">isSchool</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">read</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">subscribed</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">ignorePost</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">canPost</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">createdAt</span>": <span class="value"><span class="string">"2016-05-17T11:15:15.714Z"</span></span>,</span><br><span class="line">    "<span class="attribute">updatedAt</span>": <span class="value"><span class="string">"2016-07-15T10:50:49.208Z"</span></span><br><span class="line">  </span>&#125;, ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>æœ‰æä¾›åƒæ•¸ <code>no_school</code> èª¿æ•´è¦ä¸è¦å­¸æ ¡çœ‹æ¿çš„è³‡è¨Šï¼Œå¾ä¸Šé¢çš„ <code>json</code> æ ¼å¼çœ‹å¾—å‡º <code>isSchool</code> çµ¦æˆ‘å€‘è¶³å¤ çš„è¨Šæ¯ä¾†åˆ¤æ–·</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">metadata_forums = Forum.get()  <span class="comment"># å–å¾—æ‰€æœ‰çœ‹æ¿</span></span><br><span class="line">metadata_forums = Forum.get(no_school=<span class="keyword">True</span>)  <span class="comment"># éæ¿¾æ‰å­¸æ ¡çœ‹æ¿</span></span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
<li><p><code>get_metas()</code> æ˜¯å¯¦ä¾‹æ–¹æ³• (instance method)</p>
<ul>
<li><p>ç”¨ä¾†å–å¾—å„ç¯‡æ–‡ç« çš„å¾Œè¨­è³‡è¨Š (metadata)ï¼Œ</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> dcard.forums <span class="keyword">import</span> Forum</span><br><span class="line">forum = Forum(<span class="string">'funny'</span>)</span><br><span class="line">forum.get_metas()</span><br></pre></td></tr></table></figure>
</li>
<li><p>API å–å¾—çš„çµæœåŒæ¨£æ˜¯ <code>json</code> çš„ listï¼ŒåŸå§‹è³‡æ–™å¤§æ¦‚é•·é€™æ¨£ï¼šï¼ˆç¨‹å¼è£¡å°±æ˜¯ list of <code>dict</code>ï¼‰</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">[</span><br><span class="line">  ...</span><br><span class="line">  &#123;</span><br><span class="line">    "<span class="attribute">tags</span>": <span class="value">[<span class="string">"è€çˆ¸"</span>, <span class="string">"ä¸‰æœ¬"</span>, <span class="string">"ç½µäºº"</span>]</span>,</span><br><span class="line">    "<span class="attribute">title</span>": <span class="value"><span class="string">"è€çˆ¸ï¼Œä¸æ˜¯é€™æ¨£çš„å§ï¼ğŸ˜‚"</span></span>,</span><br><span class="line">    "<span class="attribute">forumName</span>": <span class="value"><span class="string">"æœ‰è¶£"</span></span>,</span><br><span class="line">    "<span class="attribute">anonymousSchool</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">forumAlias</span>": <span class="value"><span class="string">"funny"</span></span>,</span><br><span class="line">    "<span class="attribute">createdAt</span>": <span class="value"><span class="string">"2016-07-15T10:57:02.876Z"</span></span>,</span><br><span class="line">    "<span class="attribute">school</span>": <span class="value"><span class="string">"ä¸­å±±å¤§å­¸"</span></span>,</span><br><span class="line">    "<span class="attribute">commentCount</span>": <span class="value"><span class="number">0</span></span>,</span><br><span class="line">    "<span class="attribute">updatedAt</span>": <span class="value"><span class="string">"2016-07-15T10:57:02.876Z"</span></span>,</span><br><span class="line">    "<span class="attribute">forumId</span>": <span class="value"><span class="string">"a1aaa6e6-2594-4968-b7dc-e1b14bea96f4"</span></span>,</span><br><span class="line">    "<span class="attribute">likeCount</span>": <span class="value"><span class="number">0</span></span>,</span><br><span class="line">    "<span class="attribute">excerpt</span>": <span class="value"><span class="string">"é›–ç„¶å®¶åœ¨é«˜é›„ä½†ç”±æ–¼ä¸‹å­¸æœŸæ¯”è¼ƒå¿™æ‰€ä»¥ä¹Ÿå¾ˆå°‘å›å®¶\nï¼ˆé€™å¥½åƒä¸æ˜¯é‡é»ğŸ˜‚ï¼‰\n-\næ”¾æš‘å‡å¾Œç•¶ç„¶æ²’äº‹å°±è¶•ç·Šå›å®¶å•¦ï¼\nå‰å¹¾å¤©çœ‹åˆ°è€çˆ¸åœ¨çœ‹é›»è¦–ï¼Œçªç„¶è½åˆ°ä¸€é™£å¤§ç¬‘\nã€Œå“ˆå“ˆå“ˆå“ˆï¼Œäº”åå…­å•Šï¼Œå“ˆå“ˆå“ˆå“ˆã€\n-\næˆ‘å¿ƒè£¡æƒ³ï¼Œè›¤äº”"</span></span>,</span><br><span class="line">    "<span class="attribute">id</span>": <span class="value"><span class="number">224362465</span></span>,</span><br><span class="line">    "<span class="attribute">anonymousDepartment</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">pinned</span>": <span class="value"><span class="literal">false</span></span>,</span><br><span class="line">    "<span class="attribute">department</span>": <span class="value"><span class="string">"ä¼æ¥­ç®¡ç†å­¸ç³»"</span></span>,</span><br><span class="line">    "<span class="attribute">replyId</span>": <span class="value"><span class="literal">null</span></span>,</span><br><span class="line">    "<span class="attribute">gender</span>": <span class="value"><span class="string">"M"</span></span>,</span><br><span class="line">    "<span class="attribute">replyTitle</span>": <span class="value"><span class="literal">null</span></span><br><span class="line">  </span>&#125;, ...</span><br><span class="line">]</span><br></pre></td></tr></table></figure>
</li>
<li><p>æä¾›è±å¯Œçš„åƒæ•¸èª¿æ§ï¼Œè®“ä¹‹å¾Œçš„å°ˆæ¡ˆé–‹ç™¼æ›´ä¾¿åˆ©ï¼ˆä¹‹å¾Œçš„ <code>dcard-lumberjack</code> å°ˆæ¡ˆå¤§é‡ä½¿ç”¨æ­¤æ–¹æ³•çš„åƒæ•¸è¨­å®šï¼‰ã€‚</p>
<ul>
<li><code>num</code>: å–å¾—å¹¾ç¯‡çš„æ–‡ç« å¾Œè¨­è³‡è¨Š (metadata of post)ã€‚ / é è¨­: 30ç¯‡</li>
<li><code>sort</code>: <code>popular</code> / <code>new</code>ï¼Œæ±ºå®šç”¨ä»€éº¼æ’åºæ–¹æ³•æŸ¥è©¢ (sorted by)ï¼Œæœ€æ–°æˆ–æœ€ç†±é–€æ’åºã€‚ / é è¨­: <code>&#39;new&#39;</code></li>
<li><code>timebound</code>: <code>&#39;{ISO-8601 æ™‚é–“å­—ä¸²}&#39;</code>ï¼Œè‹¥ç”¨ <code>new</code> ä¾†æ’åºæŸ¥è©¢çš„è©±ï¼Œè¦æŸ¥è©¢åˆ°å¤šæ—©ã€‚ï¼ˆä½¿ç”¨ UTC æ™‚é–“ï¼Œä¾ç…§<a href="https://zh.wikipedia.org/wiki/ISO_8601" target="_blank" rel="external">ISO-8601</a>è¡¨ç¤ºæ³•è½‰æˆå­—ä¸²ï¼‰ / é è¨­: <code>&#39;&#39;</code>ï¼ˆç©ºå­—ä¸²ï¼‰</li>
<li><code>callback</code>: ä¸ç›´æ¥å›å‚³ metasï¼Œæœƒå…ˆå¥—ç”¨æ­¤å‡½å¼å†å›å‚³ <code>callback_function</code> çš„æœ€çµ‚å€¼ï¼Œå¯ç•¶ä½œä¸€ç¨® reducerï¼Œæ¸›å°‘è³‡æ–™è¤‡é›œåº¦ã€‚ / é è¨­: None<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">''' scenario examples '''</span></span><br><span class="line">forum = Forum(<span class="string">'studyabroad'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 1. å–å¾—çœ‹æ¿ç†±é–€ 500 ç¯‡            </span></span><br><span class="line">metas = forum.get_metas(num=<span class="number">500</span>, sort=<span class="string">'popular'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 2. å–å¾—çœ‹æ¿ 500 ç¯‡</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> ä¿ç•™å¾ˆå¤šè®šçš„æ–‡ç« <span class="params">(metas)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> [meta <span class="keyword">for</span> meta <span class="keyword">in</span> metas <span class="keyword">if</span> meta[<span class="string">'likeCount'</span>] &gt;= <span class="number">50</span>]</span><br><span class="line">metas = forum.get_metas(num=<span class="number">500</span>, callback=ä¿ç•™å¾ˆå¤šè®šçš„æ–‡ç« )</span><br><span class="line"></span><br><span class="line"><span class="comment"># 3. å–å¾— ç„¡é™å¤šç¯‡ æ–‡ç« è³‡è¨Šï¼Œç›´åˆ°è©²æ¿ç„¡æ–‡ç« </span></span><br><span class="line">metas = forum.get_metas(num=forums.infinite_page)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4. å–å¾—æ—¥æœŸåœ¨ æœ€è¿‘ä¸‰å€‹æœˆ çš„æ–‡ç« è³‡è¨Š</span></span><br><span class="line">boundary_date = datetime.datetime.utcnow() - datetime.timedelta(months=<span class="number">3</span>)</span><br><span class="line">metas = forum.get_metas(</span><br><span class="line">            num=forums.infinite_page, timebound=boundary_date.isoformat())</span><br></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>
</li>
</ol>
</li>
</ul>
<h4 id="Forums_full_code"><a href="#Forums_full_code" class="headerlink" title="Forums full code"></a>Forums full code</h4><p>é€™é‚Šé™„ä¸Š <code>dcard/forums.py</code> éƒ¨åˆ†å¯¦ä½œç¨‹å¼ç¢¼ä»¥åŠè§£èªªã€‚</p>
<ul>
<li>ä¸€äº›å¸¸æ•¸å®šç¾©<ul>
<li><code>metas_per_page</code> æ˜¯ <code>Dcard</code> API çš„ spec</li>
<li>å¦å¤–é æ•¸éƒ½æ‡‰è©²æ˜¯å¤§æ–¼ç­‰æ–¼é›¶çš„æ•´æ•¸ï¼Œæ‰€ä»¥å°‡ <code>infinite_page</code> æ¨¡å¼å®šç‚ºå¸¸æ•¸ -1</li>
</ul>
</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">""" forums.py """</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Forum</span>:</span></span><br><span class="line">    metas_per_page = <span class="number">30</span></span><br><span class="line">    infinite_page = -<span class="number">1</span></span><br></pre></td></tr></table></figure>
<ul>
<li>é€™é‚Šå¯ä»¥çœ‹åˆ°å„é …åƒæ•¸çš„å¯¦éš›ä½¿ç”¨ç‹€æ³ï¼›å°¤å…¶æ˜¯ <code>callback</code> åƒæ•¸å¯¦éš›åœ¨ package è£¡çš„ä½¿ç”¨æ™‚æ©Ÿã€‚</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_metas</span><span class="params">(self, num=<span class="number">30</span>, sort=<span class="string">'new'</span>, timebound=None, callback=None)</span>:</span></span><br><span class="line">    logger.info(<span class="string">'&lt;%s&gt; é–‹å§‹å–å¾—çœ‹æ¿å…§æ–‡ç« è³‡è¨Š'</span> % self.forum)</span><br><span class="line"></span><br><span class="line">    paged_metas = self._get_paged_metas(sort, num, timebound)</span><br><span class="line"></span><br><span class="line">    buff = flatten_lists((metas <span class="keyword">for</span> metas <span class="keyword">in</span> paged_metas))</span><br><span class="line">    results = callback(buff) <span class="keyword">if</span> callback <span class="keyword">else</span> buff</span><br><span class="line"></span><br><span class="line">    logger.info(<span class="string">'&lt;%s&gt; è³‡è¨Šè’é›†å®Œæˆï¼Œå…±%dç­†'</span> % (self.forum, len(buff)))</span><br><span class="line">    <span class="keyword">return</span> results</span><br></pre></td></tr></table></figure>
<ul>
<li>é€™å€‹æ˜¯ <code>get_meta()</code> å¯¦éš›è² è²¬å„é …åˆ¤æ–·åŠè™•ç† API è³‡æ–™å›å‚³å›ä¾†çš„å¯¦éš› worker</li>
</ul>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_get_paged_metas</span><span class="params">(self, sort, num, timebound=<span class="string">''</span>)</span>:</span></span><br><span class="line">    params = &#123;<span class="string">'popular'</span>: <span class="keyword">False</span>&#125; <span class="keyword">if</span> sort == <span class="string">'new'</span> <span class="keyword">else</span> &#123;&#125;</span><br><span class="line">    pages = -(-num // self.metas_per_page) <span class="keyword">if</span> num &gt;= <span class="number">0</span> <span class="keyword">else</span> self.infinite_page</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">approved_metas</span><span class="params">(metas)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> num <span class="keyword">and</span> page == pages:</span><br><span class="line">            metas = metas[:num - (pages - <span class="number">1</span>) * self.metas_per_page]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> timebound:</span><br><span class="line">            metas = [m <span class="keyword">for</span> m <span class="keyword">in</span> metas <span class="keyword">if</span> m[<span class="string">'updatedAt'</span>] &gt; timebound]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> metas</span><br><span class="line"></span><br><span class="line">    page = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> page != pages:</span><br><span class="line">        page += <span class="number">1</span></span><br><span class="line">        metas = self.client.get(self.posts_meta_url, params=params)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> len(metas) == <span class="number">0</span>:</span><br><span class="line">            logger.warning(<span class="string">'[%s] å·²åˆ°æœ€æœ«é ï¼Œç¬¬%dé !'</span> % (self.forum, page))</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        params[<span class="string">'before'</span>] = metas[-<span class="number">1</span>][<span class="string">'id'</span>]</span><br><span class="line"></span><br><span class="line">        metas = approved_metas(metas)</span><br><span class="line">        <span class="keyword">if</span> len(metas) == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">yield</span> metas</span><br></pre></td></tr></table></figure>
<p>ä»¥ä¸Šå°±æ˜¯è² è²¬è™•ç† <code>çœ‹æ¿ (Forums)</code> çš„ moduleã€‚</p>
<p>ä¸‹åŠç¯‡å¾…çºŒæ›´æ–°<br>Salas.</p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://yoursite.com/2016/dcard-spider-python-package/" data-id="cir8z34v30008jowrsvedvz5f" class="article-share-link">Share</a>
      
        <a href="http://yoursite.com/2016/dcard-spider-python-package/#disqus_thread" class="article-comment-link">Comments</a>
      
      
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Python/">Python</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/Spider/">Spider</a></li></ul>

    </footer>
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/Dccard-crawler/" id="article-nav-older" class="article-nav-link-wrap">
      <strong class="article-nav-caption">Older</strong>
      <div class="article-nav-title">Dccard çˆ¬èŸ²ï¼Œé€éå®˜æ–¹API</div>
    </a>
  
</nav>

  
</article>


<section id="comments">
  <div id="disqus_thread">
    <noscript>Please enable JavaScript to view the <a href="//disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
  </div>
</section>
</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list"><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hello/">Hello</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Hexo/">Hexo</a><span class="tag-list-count">1</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Python/">Python</a><span class="tag-list-count">3</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/Spider/">Spider</a><span class="tag-list-count">2</span></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/é–‹ç®±æ–‡/">é–‹ç®±æ–‡</a><span class="tag-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/Hello/" style="font-size: 10px;">Hello</a> <a href="/tags/Hexo/" style="font-size: 10px;">Hexo</a> <a href="/tags/Python/" style="font-size: 20px;">Python</a> <a href="/tags/Spider/" style="font-size: 15px;">Spider</a> <a href="/tags/é–‹ç®±æ–‡/" style="font-size: 10px;">é–‹ç®±æ–‡</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/07/">ä¸ƒæœˆ 2016</a><span class="archive-list-count">2</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2016/02/">äºŒæœˆ 2016</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/12/">åäºŒæœˆ 2015</a><span class="archive-list-count">1</span></li><li class="archive-list-item"><a class="archive-list-link" href="/archives/2015/07/">ä¸ƒæœˆ 2015</a><span class="archive-list-count">1</span></li></ul>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recents</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2016/dcard-spider-python-package/">Dcard çˆ¬èŸ²æ–¼ Python å¯¦ä½œæˆæœï¼šdcard-spider</a>
          </li>
        
          <li>
            <a href="/2016/Dccard-crawler/">Dccard çˆ¬èŸ²ï¼Œé€éå®˜æ–¹API</a>
          </li>
        
          <li>
            <a href="/2016/çˆ¬èŸ²/">ç¶²è·¯çˆ¬èŸ² Crawler Tutorial - (1) ç°¡ä»‹</a>
          </li>
        
          <li>
            <a href="/2015/hello-world/">ä½ å¥½ï¼Œæˆ‘æ˜¯â€¦</a>
          </li>
        
          <li>
            <a href="/2015/python-fantasy/">Python å¥‡å¹»ä¹‹æ—…ï¼šæˆ‘åˆ°åº•çœ‹äº†ä»€éº¼ï¼</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 Salas (leVirve)<br>
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    
<script>
  var disqus_shortname = 'salasnote';
  
  var disqus_url = 'http://yoursite.com/2016/dcard-spider-python-package/';
  
  (function(){
    var dsq = document.createElement('script');
    dsq.type = 'text/javascript';
    dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();
</script>


<script src="//ajax.googleapis.com/ajax/libs/jquery/2.0.3/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>

  </div>
</body>
</html>